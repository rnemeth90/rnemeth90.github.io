<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>vmware on GeekyRyan</title><link>https://rnemeth90.github.io/tags/vmware/</link><description>GeekyRyan (vmware)</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Sat, 31 Oct 2020 01:22:00 +0000</lastBuildDate><atom:link href="https://rnemeth90.github.io/tags/vmware/index.xml" rel="self" type="application/rss+xml"/><item><title>Reset GRUB/root Password for vCenter/PSC Appliance</title><link>https://rnemeth90.github.io/posts/2020-10-31-reset-grubroot-password-for-vcenterpsc/</link><pubDate>Sat, 31 Oct 2020 01:22:00 +0000</pubDate><guid>https://rnemeth90.github.io/posts/2020-10-31-reset-grubroot-password-for-vcenterpsc/</guid><description>&lt;p>In Redhat/Fedora/Cent, GRUB can be protected by running the grub-md5-crypt command and pasting the outputted password hash into the grub.conf file. vSphere 6.0 password protects grub by default. If you change the root password in the VAMI, the GRUB password is changed to match. If you do not change the root password, the GRUB password is “vmware”.&lt;/p>
&lt;p>To reset the GRUB password, we need to boot into a Cent or Redhat live CD. The ISO can be obtained here: &lt;a href="https://www.centos.org/download/">https://www.centos.org/download/&lt;/a>. Its best to upload the ISO to a datastore that the appliance has access to.&lt;/p>
&lt;p>Stop the appliance and attach the ISO:&lt;/p>
&lt;p>&lt;img src="https://rnemeth90.github.io/wp-content/uploads/2020/10/image.png" alt="">&lt;/p>
&lt;p>Be sure to select the “Connect at Power On” option. Boot the VM into the ISO and select the “Troubleshooting” option.&lt;/p>
&lt;p>&lt;img src="https://rnemeth90.github.io/wp-content/uploads/2020/10/image-1.png" alt="">
Next, choose “Rescure a Red hat (or CentOS depending on your ISO) Enterprise Linux System”&lt;/p>
&lt;p>&lt;img src="https://rnemeth90.github.io/wp-content/uploads/2020/10/image-2.png" alt="">&lt;/p>
&lt;p>Select “Continue” to mount the VCSA 6.0’s root filesystem in Read/write mode under /mnt/sysimage. RHEL 7.2 is capable to detect the VCSA’s root volume and mounts it.&lt;/p>
&lt;p>&lt;img src="https://rnemeth90.github.io/wp-content/uploads/2020/10/image-3.png" alt="">&lt;/p>
&lt;p>The VCSA root filesystem is mounted under /mnt/sysimage and you can now access (and modify) it using the shell. Navigate to /mnt/sysimage/boot and list the contents. You’ll see we now have access to the grub directory:&lt;/p>
&lt;p>&lt;img src="https://rnemeth90.github.io/wp-content/uploads/2020/10/image-4.png" alt="">&lt;/p>
&lt;p>cd to the grub directory and list the contents. Look for a file called “menu.lst”. This file holds the grub boot loader password. Open this file with vi by typing “vi menu.lst”. Navigate to the line beginning with “password” using the arrow keys, and then type “dd” to remove the line.&lt;/p>
&lt;p>&lt;img src="https://rnemeth90.github.io/wp-content/uploads/2020/10/image-5.png" alt="">
You can then save the file by pressing “:wq” (without quotes). You can now cat the file and see that the password has been removed.&lt;/p>
&lt;p>&lt;img src="https://rnemeth90.github.io/wp-content/uploads/2020/10/image-6.png" alt="">&lt;/p>
&lt;p>Exit the shell (this will reboot the server). Detach the ISO and boot the appliance. Once the system is booted, stop the VCSA in the GRUB menu (by pressing the escape key during boot) to break the OS root password.&lt;/p>
&lt;p>&lt;a href="https://rnemeth90.github.io/wp-content/uploads/2020/10/image-7.png">&lt;/a>
Press “e” to edit the boot commands for the kernel.&lt;/p>
&lt;p>&lt;img src="https://rnemeth90.github.io/wp-content/uploads/2020/10/image-8.png" alt="">&lt;/p>
&lt;p>Append “init=/bin/bash” to the line in this step and press enter.&lt;/p>
&lt;p>&lt;img src="https://rnemeth90.github.io/wp-content/uploads/2020/10/image-9.png" alt="">&lt;/p>
&lt;p>Press “b” to boot the system.&lt;/p>
&lt;p>&lt;img src="https://rnemeth90.github.io/wp-content/uploads/2020/10/image-10.png" alt="">&lt;/p>
&lt;p>You will now boot into a bash shell where you can set the root password.&lt;/p>
&lt;p>&lt;img src="https://rnemeth90.github.io/wp-content/uploads/2020/10/image-11.png" alt="">&lt;/p>
&lt;p>Once this is done, exit the shell by typing “exit”. You can now boot the appliance and login with your new root password.&lt;/p></description></item><item><title>Could not connect to VMware Directory Service via LDAP when Deploying New vCenter Appliance</title><link>https://rnemeth90.github.io/posts/2020-10-28-could-not-connect-to-vmware-directory/</link><pubDate>Wed, 28 Oct 2020 13:51:00 +0000</pubDate><guid>https://rnemeth90.github.io/posts/2020-10-28-could-not-connect-to-vmware-directory/</guid><description>&lt;p>Problem:&lt;/p>
&lt;p>Deploying a brand new vCSA 6.7 appliance results in the following error during the second stage of the deployment.&lt;/p>
&lt;p>&lt;a href="https://rnemeth90.github.io/wp-content/uploads/2020/10/2020-10-28_07h29_02.png">&lt;img src="https://rnemeth90.github.io/wp-content/uploads/2020/10/2020-10-28_07h29_02.png" alt="">&lt;/a>&lt;span style="text-align: left;"> &lt;/span>&lt;/p>
&lt;p>Solution:&lt;/p>
&lt;p>This problem is almost always caused by DNS resolution. Once you create the appropriate A and PTR record for your appliance on a LOCAL DNS server, you should be to successfully complete the deployment. Local DNS resolution is required, you cannot use a public DNS server while installing vCenter. For example, 8.8.8.8 will not work.&lt;/p>
&lt;p>Since you have already completed Stage 1 of the deployment, you can login to the appliance via SSH and update the DNS settings. This will only work if you chose to enable SSH during Stage 2 of the deployment.&lt;/p>
&lt;p>SSH to the appliance and run “/opt/vmware/share/vami/vami_config_net” (without quotes). Choose option 4 to update DNS settings and option 3 to update the hostname (if necessary). The deployment wizard states that a hostname is optional, but it is actually required. I have never had a successful deployment without specifying the hostname.&lt;/p>
&lt;p>&lt;a href="https://rnemeth90.github.io/wp-content/uploads/2020/10/2020-10-28_07h33_18.png">&lt;img src="https://rnemeth90.github.io/wp-content/uploads/2020/10/2020-10-28_07h33_18.png" alt="">&lt;/a>&lt;/p>
&lt;p>You can then verify the DNS settings have been updated in the resolve.conf:&lt;/p>
&lt;p>&lt;a href="https://rnemeth90.github.io/wp-content/uploads/2020/10/2020-10-28_07h33_57.png">&lt;img src="https://rnemeth90.github.io/wp-content/uploads/2020/10/2020-10-28_07h33_57.png" alt="">&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://rnemeth90.github.io/wp-content/uploads/2020/10/2020-10-28_08h47_36.png">&lt;img src="https://rnemeth90.github.io/wp-content/uploads/2020/10/2020-10-28_08h47_36.png" alt="">&lt;/a>&lt;/p></description></item><item><title>Azure Site Recovery &amp;#8211; VMware-to-Azure: Wrong IP address discovered for VM</title><link>https://rnemeth90.github.io/posts/2018-08-21-azure-site-recovery-vmware-to-azure/</link><pubDate>Tue, 21 Aug 2018 17:26:00 +0000</pubDate><guid>https://rnemeth90.github.io/posts/2018-08-21-azure-site-recovery-vmware-to-azure/</guid><description>&lt;p>When replicating virtual machines from VMware to Azure using Site Recovery, you may encounter an issue where the Configuration server discovers the wrong IP address for a VM. This can be caused by stale entries within the infrastructurevms MySQL table that is used by ASR to track VM attributes.&lt;/p>
&lt;p>To resolve this issue, you first need to disable replication for the VM in the Azure Portal.&lt;/p>
&lt;p>&lt;a href="https://rnemeth90.github.io/wp-content/uploads/2018/08/2018-08-21_13h20_26.png">&lt;img src="https://rnemeth90.github.io/wp-content/uploads/2018/08/2018-08-21_13h20_26.png" alt="">&lt;/a>&lt;/p>
&lt;p>Next, login to your ASR Configuration Server and open a CMD prompt as administrator. Browse to the bin directory for your ASR installation. For example, in my case ASR is installed on the E: partition under the following directory:&lt;/p>
&lt;p>E:\Program Files (x86)Microsoft Azure Site Recoveryhomesvsystemsbin&lt;/p>
&lt;p>Type in this command to remove the VM from the ASR database (replace IP address with the IP of your VM):&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-perl" data-lang="perl">&lt;span style="display:flex;">&lt;span>perl Unregister&lt;span style="color:#f92672">-&lt;/span>ASRComponent&lt;span style="color:#f92672">.&lt;/span>pl &lt;span style="color:#f92672">-&lt;/span>IPAddress &lt;span style="color:#ae81ff">10.0.0.4&lt;/span> &lt;span style="color:#f92672">-&lt;/span>Component Source
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>That’s it. You should now be able to reconfigure replication for the VM, and ASR will discover the correct info about the VM.&lt;/p></description></item><item><title>Remove Stubborn PSC or vCenter Appliance from an SSO Domain</title><link>https://rnemeth90.github.io/posts/2017-11-08-remove-stubborn-psc-or-vcenter/</link><pubDate>Wed, 08 Nov 2017 07:56:00 +0000</pubDate><guid>https://rnemeth90.github.io/posts/2017-11-08-remove-stubborn-psc-or-vcenter/</guid><description>&lt;p>While attempting to decommission one of our vCenter sites, I ran into an issue removing one of the PSCs. This site consisted of two PSCs and one vCenter appliance. I removed the first PSC from the SSO domain successfully, and then removed the vCenter appliance. Things became a little tricky during the removal of the final PSC. This PSC did not get removed even after running the cmsso-util command. This article will detail the steps I took in decommissioning the site, as well as removing the stubborn PSC.&lt;/p>
&lt;p>First, we need to check if vCenter is currently using the PSC we plan on decommissioning. If it is, we need to use the cmsso-util command to redirect vCenter to a different PSC. Instructions for redirecting vCenter can be found here: &lt;a href="https://kb.vmware.com/s/article/2113917?language=en_US">https://kb.vmware.com/s/article/2113917?language=en_US&lt;/a>&lt;/p>
&lt;p>To check what PSC your vCSA is currently pointing to, browse to the Advanced Settings for the vCSA in the vSphere Web Client. Filter by this key: config.vpxd.sso.admin.uri&lt;/p>
&lt;p>To remove a PSC or vCSA from an SSO domain, connect to a PSC via SSH and run these commands:&lt;/p>
&lt;p>To remove a PSC from the vSphere SSO domain:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>cmsso-util unregister –node-pnid psc01.ad.vcplab.local –username administrator@your&lt;span style="color:#ae81ff">\_&lt;/span>domain&lt;span style="color:#ae81ff">\_&lt;/span>name –passwd vCenter&lt;span style="color:#ae81ff">\_&lt;/span>Single&lt;span style="color:#ae81ff">\_&lt;/span>Sign&lt;span style="color:#ae81ff">\_&lt;/span>On&lt;span style="color:#ae81ff">\_&lt;/span>password
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>To remove a vCSA from the vSphere SSO domain:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>cmsso-util unregister –node-pnid vcsa.ad.vcplab.local –username administrator@your&lt;span style="color:#ae81ff">\_&lt;/span>domain&lt;span style="color:#ae81ff">\_&lt;/span>name –passwd vCenter&lt;span style="color:#ae81ff">\_&lt;/span>Single&lt;span style="color:#ae81ff">\_&lt;/span>Sign&lt;span style="color:#ae81ff">\_&lt;/span>On&lt;span style="color:#ae81ff">\_&lt;/span>password
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>After running these commands, delete the virtual appliances. You can also verify the appliances have been removed by browsing to Administration &amp;gt; System Configuration &amp;gt; Nodes in the vSphere Web Client.&lt;/p>
&lt;p>If cmsso-util fails to remove any of the nodes, you can use this command to force the removal:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>vdcleavefed -h vcsa.ad.vcplab.local -u Administrator -w Passw0rd!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Upon successful completion, you should see something like this:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>/usr/lib/vmware-vmdir/bin/vdcleavefed -h vcsa.ad.vcplab.local -u administrator* password:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>vdcleavefd offline &lt;span style="color:#66d9ef">for&lt;/span> server vcsa.ad.vcplab.local
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Leave federation cleanup &lt;span style="color:#66d9ef">done&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>When specifying the username, use the SSO admin (administrator). However, do not use the full UPN (&lt;a href="mailto:administrator@vsphere.local">administrator@vsphere.local&lt;/a>). Doing so will cause the command to fail.&lt;/p></description></item><item><title>Running vSphere in VMware Workstation 12</title><link>https://rnemeth90.github.io/posts/2017-05-29-running-vsphere-in-vmware-workstation-12/</link><pubDate>Mon, 29 May 2017 01:09:00 +0000</pubDate><guid>https://rnemeth90.github.io/posts/2017-05-29-running-vsphere-in-vmware-workstation-12/</guid><description>&lt;p>In this post I’ll be walking through how to run a vSphere lab in VMware Workstation. I recently decided to obtain VCP6-DCV. Rather than driving up my electric bill like I’ve done in the past using physical servers, I’m attempting to run the entire lab on my workstation and a Synology NAS.&lt;/p>
&lt;p>If you’ve ever installed ESXi, installing it in Workstation will be a familiar process for you. VMware tools is included in the installation disc, which makes installing ESXi in Workstation dramatically easier than it used to be. . The process is very simple, so I won’t be going through those steps here unless someone asks me to in the comments. I also will not be going through the process of installing Windows Server or configuring a domain controller/DNS/DHCP, as I am sure you have done so in the past if you are reading this.&lt;/p>
&lt;p>So that really only leaves us with installing vCenter. Most of the blogs I found for installing vCenter in VMware Workstation 12 were not accurate, and often left me with a broken installation. The process is somewhat straight-forward when deploying from the OVA. Let’s get started.&lt;/p>
&lt;p>First, download the OVA for vCenter here: &lt;a href="https://my.vmware.com/web/vmware/details?productId=614&amp;amp;downloadGroup=VC650">Download vCenter&lt;/a>&lt;/p>
&lt;p>Once the download has completed, click File &amp;gt; Open in Workstation. Browse to the OVA, then give your new VM a name and location if necessary. Accept the EULA when prompted.&lt;/p>
&lt;p>Be sure to read it! 😎&lt;/p>
&lt;p>Once the OVA finishes importing, do not power on the VM! There is some customization we need to do first. Close Workstation if it is open. Browse to the location on your PC that you imported the VM to. I’m using a Windows OS, so I will use File Explorer. Open the .VMX file (use Notepad or another text editor):&lt;/p>
&lt;p>&lt;a href="https://rnemeth90.github.io/wp-content/uploads/2017/05/2017-05-28_21h00_04.png">&lt;img src="https://rnemeth90.github.io/wp-content/uploads/2017/05/2017-05-28_21h00_04.png" alt="">&lt;/a>&lt;/p>
&lt;p>This is the configuration file for your virtual machine. We can use it to customize the name, IPv4/6 details, DNS domain, etc. Scroll down to the last line of text, and paste this in:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>guestinfo.cis.vmdir.password &lt;span style="color:#f92672">=&lt;/span> “vmware!”
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>guestinfo.cis.appliance.net.addr.family &lt;span style="color:#f92672">=&lt;/span> “ipv4”
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>guestinfo.cis.appliance.net.addr &lt;span style="color:#f92672">=&lt;/span> “10.0.0.15”
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>guestinfo.cis.appliance.net.prefix &lt;span style="color:#f92672">=&lt;/span> “24”
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>guestinfo.cis.appliance.net.mode &lt;span style="color:#f92672">=&lt;/span> “static”
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>guestinfo.cis.appliance.net.dns.servers &lt;span style="color:#f92672">=&lt;/span> “10.0.0.10”
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>guestinfo.cis.appliance.net.gateway &lt;span style="color:#f92672">=&lt;/span> “10.0.0.1”
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>guestinfo.cis.appliance.root.passwd &lt;span style="color:#f92672">=&lt;/span> “vmware!”
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Customize the above code to your needs. You will likely need to change the IPv4 details. Save the .VMX file and close your text editor. Now you can power on the virtual machine, and vCenter will run through the installation process. The installation can take around 10-15 minute in my experience. You may see generic login screens during the installation of Photon, do not login or interrupt the installation. Once it is complete, you should see the DCUI below:&lt;/p>
&lt;p>&lt;a href="https://rnemeth90.github.io/wp-content/uploads/2017/05/2017-05-24_10h11_00.png">&lt;img src="https://rnemeth90.github.io/wp-content/uploads/2017/05/2017-05-24_10h11_00.png" alt="">&lt;/a>&lt;/p>
&lt;p>You should now be able to browse to the IP address or DNS name of your vCenter server. Once you complete the configuration, you can login and see the page below:
&lt;a href="https://rnemeth90.github.io/wp-content/uploads/2017/05/2017-05-24_10h10_39.png">&lt;img src="https://rnemeth90.github.io/wp-content/uploads/2017/05/2017-05-24_10h10_39.png" alt="">&lt;/a>&lt;/p>
&lt;p>In my lab I am running 3 ESXi hosts, 1 Windows Server, and one vCenter server. Plenty to study for the VCP lab.&lt;/p>
&lt;p>&lt;a href="https://rnemeth90.github.io/wp-content/uploads/2017/05/2017-05-24_10h11_31.png">&lt;img src="https://rnemeth90.github.io/wp-content/uploads/2017/05/2017-05-24_10h11_31.png" alt="">&lt;/a>&lt;/p>
&lt;p>Good luck and be sure to leave a comment if you have any questions!&lt;/p></description></item></channel></rss>